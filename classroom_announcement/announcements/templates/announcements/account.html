<!--
    Account Page Template for Classroom Announcement Application
    
    This template displays comprehensive user account information including:
    - User profile header with join date
    - Statistics overview (rooms, announcements, reactions)
    - Owned rooms list with member counts
    - Joined rooms list with role indicators
    - Recent activity timeline
    
    Design Features:
    - Glassmorphism design theme
    - Responsive grid layout
    - Role-based indicators and badges
    - Activity timeline with icons
    
    Context Variables:
    - user: Current authenticated user
    - owned_rooms: Rooms created by the user
    - joined_rooms: Rooms where user is a member
    - *_count: Various statistics counters
    - recent_activity: List of recent user activities
-->

{% extends 'announcements/app_base.html' %}
{% load static %}

{% block title %}My Account - ClassroomHub{% endblock %}

{% block extra_css %}
<style>
.account-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

.navbar {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.nav-brand {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.logo {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 1.2rem;
}

.nav-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2c3e50;
}

.nav-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(103, 126, 234, 0.1);
    padding: 0.5rem 1rem;
    border-radius: 50px;
    color: #667eea;
    font-weight: 500;
}

.btn-logout {
    background: linear-gradient(135deg, #ff6b6b, #ee5a24);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
}

.btn-logout:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(238, 90, 36, 0.4);
}

.main-content {
    padding: 2rem;
    max-width: 1200px;
    margin: 0 auto;
}

.btn-back {
    background: rgba(255, 255, 255, 0.9);
    color: #667eea;
    border: 2px solid #667eea;
    padding: 0.75rem 1.5rem;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 2rem;
}

.btn-back:hover {
    background: #667eea;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(103, 126, 234, 0.3);
}

.account-header {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 25px;
    padding: 3rem;
    margin-bottom: 2rem;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    text-align: center;
    position: relative;
    overflow: hidden;
}

.account-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.profile-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 3rem;
    margin: 0 auto 1.5rem;
    box-shadow: 0 10px 30px rgba(103, 126, 234, 0.3);
}

.profile-name {
    font-size: 2.5rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.profile-username {
    font-size: 1.2rem;
    color: #7f8c8d;
    margin-bottom: 1rem;
}

.profile-joined {
    font-size: 1rem;
    color: #95a5a6;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--card-color, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
}

.stat-card.rooms-owned::before {
    background: linear-gradient(135deg, #f39c12, #e67e22);
}

.stat-card.rooms-joined::before {
    background: linear-gradient(135deg, #3498db, #2980b9);
}

.stat-card.announcements::before {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
}

.stat-card.reactions::before {
    background: linear-gradient(135deg, #9b59b6, #8e44ad);
}

.stat-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
}

.stat-icon {
    font-size: 2.5rem;
    opacity: 0.8;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: #2c3e50;
}

.stat-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.stat-description {
    color: #7f8c8d;
    font-size: 0.9rem;
}

.rooms-section {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.section-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.rooms-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
}

.room-card {
    background: rgba(255, 255, 255, 0.7);
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.room-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
}

.room-card.owned::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(135deg, #f39c12, #e67e22);
}

.room-card.admin::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(135deg, #3498db, #2980b9);
}

.room-card.member::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(135deg, #27ae60, #229954);
}

.room-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.room-name {
    font-size: 1.2rem;
    font-weight: 600;
    color: #2c3e50;
    margin: 0;
}

.room-code {
    background: rgba(103, 126, 234, 0.1);
    color: #667eea;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 600;
    letter-spacing: 1px;
}

.room-role {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 25px;
    font-weight: 500;
    font-size: 0.85rem;
    margin-bottom: 1rem;
}

.role-owner {
    background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
    color: #d63031;
}

.role-admin {
    background: linear-gradient(135deg, #a8e6cf, #81ecec);
    color: #00b894;
}

.role-member {
    background: linear-gradient(135deg, #dda0dd, #da70d6);
    color: #8e44ad;
}

.room-stats {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.room-stat {
    text-align: center;
}

.room-stat-number {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2c3e50;
    display: block;
}

.room-stat-label {
    font-size: 0.8rem;
    color: #7f8c8d;
}

.room-actions {
    display: flex;
    gap: 0.5rem;
}

.btn {
    padding: 0.5rem 1rem;
    border-radius: 8px;
    border: none;
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    font-size: 0.85rem;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(103, 126, 234, 0.4);
}

.no-content {
    text-align: center;
    padding: 3rem 2rem;
    color: #7f8c8d;
}

.no-content-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.activity-section {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.activity-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border-radius: 12px;
    margin-bottom: 1rem;
    background: rgba(103, 126, 234, 0.05);
    border-left: 4px solid rgba(103, 126, 234, 0.3);
}

.activity-icon {
    font-size: 1.5rem;
    opacity: 0.7;
}

.activity-content {
    flex: 1;
}

.activity-title {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.25rem;
}

.activity-description {
    color: #7f8c8d;
    font-size: 0.9rem;
}

.activity-time {
    color: #95a5a6;
    font-size: 0.85rem;
    white-space: nowrap;
}

@media (max-width: 768px) {
    .main-content {
        padding: 1rem;
    }
    
    .account-header {
        padding: 2rem;
    }
    
    .profile-avatar {
        width: 80px;
        height: 80px;
        font-size: 2rem;
    }
    
    .profile-name {
        font-size: 2rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .rooms-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="account-container">
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-brand">
            <div class="logo">CH</div>
            <div class="nav-title">ClassroomHub</div>
        </div>
        <div class="nav-actions">
            <div class="user-info">
                üë§ {{ user.username }}
            </div>
            <a href="{% url 'logout' %}" class="btn-logout">Logout</a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Back Button -->
        <a href="{% url 'home' %}" class="btn-back">
            ‚Üê Back to Home
        </a>

        <!-- Account Header -->
        <div class="account-header">
            <div class="profile-avatar">
                {{ user.username|first|upper }}
            </div>
            <h1 class="profile-name">{{ user.first_name|default:user.username }}</h1>
            <p class="profile-username">@{{ user.username }}</p>
            <div class="profile-joined">
                üìÖ Joined {{ user.date_joined|date:"F d, Y" }}
            </div>
        </div>

        <!-- Statistics Grid -->
        <div class="stats-grid">
            <!-- Rooms Owned -->
            <div class="stat-card rooms-owned">
                <div class="stat-header">
                    <div class="stat-icon">üëë</div>
                    <div class="stat-number">{{ owned_rooms_count }}</div>
                </div>
                <div class="stat-title">Rooms Owned</div>
                <div class="stat-description">Classrooms you created and manage</div>
            </div>

            <!-- Rooms Joined -->
            <div class="stat-card rooms-joined">
                <div class="stat-header">
                    <div class="stat-icon">üè´</div>
                    <div class="stat-number">{{ joined_rooms_count }}</div>
                </div>
                <div class="stat-title">Rooms Joined</div>
                <div class="stat-description">Classrooms you're a member of</div>
            </div>

            <!-- Announcements Created -->
            <div class="stat-card announcements">
                <div class="stat-header">
                    <div class="stat-icon">üì¢</div>
                    <div class="stat-number">{{ announcements_count }}</div>
                </div>
                <div class="stat-title">Announcements</div>
                <div class="stat-description">Posts you've created</div>
            </div>

            <!-- Reactions Given -->
            <div class="stat-card reactions">
                <div class="stat-header">
                    <div class="stat-icon">üëç</div>
                    <div class="stat-number">{{ reactions_count }}</div>
                </div>
                <div class="stat-title">Reactions</div>
                <div class="stat-description">Reactions you've given</div>
            </div>
        </div>

        <!-- Owned Rooms Section -->
        {% if owned_rooms %}
        <div class="rooms-section">
            <h2 class="section-title">üëë My Classrooms ({{ owned_rooms_count }})</h2>
            <div class="rooms-grid">
                {% for room in owned_rooms %}
                    <div class="room-card owned">
                        <div class="room-header">
                            <h3 class="room-name">{{ room.room_name }}</h3>
                            <div class="room-code">{{ room.room_code }}</div>
                        </div>
                        <div class="room-role role-owner">üëë Owner</div>
                        <div class="room-stats">
                            <div class="room-stat">
                                <span class="room-stat-number">{{ room.memberships.count }}</span>
                                <span class="room-stat-label">Members</span>
                            </div>
                            <div class="room-stat">
                                <span class="room-stat-number">{{ room.announcements.count }}</span>
                                <span class="room-stat-label">Posts</span>
                            </div>
                            <div class="room-stat">
                                <span class="room-stat-number">{{ room.created_at|timesince }} ago</span>
                                <span class="room-stat-label">Created</span>
                            </div>
                        </div>
                        <div class="room-actions">
                            <a href="{% url 'room_detail' room.id %}" class="btn btn-primary">
                                üè´ Manage Room
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Joined Rooms Section -->
        {% if joined_rooms %}
        <div class="rooms-section">
            <h2 class="section-title">üéì Joined Classrooms ({{ joined_rooms_count }})</h2>
            <div class="rooms-grid">
                {% for membership in joined_rooms %}
                    <div class="room-card {{ membership.role }}">
                        <div class="room-header">
                            <h3 class="room-name">{{ membership.room.room_name }}</h3>
                            <div class="room-code">{{ membership.room.room_code }}</div>
                        </div>
                        <div class="room-role role-{{ membership.role }}">
                            {% if membership.role == 'admin' %}
                                üõ°Ô∏è Admin
                            {% else %}
                                üë§ Member
                            {% endif %}
                        </div>
                        <div class="room-stats">
                            <div class="room-stat">
                                <span class="room-stat-number">{{ membership.room.memberships.count }}</span>
                                <span class="room-stat-label">Members</span>
                            </div>
                            <div class="room-stat">
                                <span class="room-stat-number">{{ membership.room.announcements.count }}</span>
                                <span class="room-stat-label">Posts</span>
                            </div>
                            <div class="room-stat">
                                <span class="room-stat-number">{{ membership.joined_at|timesince }} ago</span>
                                <span class="room-stat-label">Joined</span>
                            </div>
                        </div>
                        <div class="room-actions">
                            <a href="{% url 'room_detail' membership.room.id %}" class="btn btn-primary">
                                üè´ View Room
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Recent Activity Section -->
        <div class="activity-section">
            <h2 class="section-title">üìà Recent Activity</h2>
            {% if recent_activity %}
                {% for activity in recent_activity %}
                    <div class="activity-item">
                        <div class="activity-icon">{{ activity.icon }}</div>
                        <div class="activity-content">
                            <div class="activity-title">{{ activity.title }}</div>
                            <div class="activity-description">{{ activity.description }}</div>
                        </div>
                        <div class="activity-time">{{ activity.time|timesince }} ago</div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="no-content">
                    <div class="no-content-icon">üìà</div>
                    <h3>No recent activity</h3>
                    <p>Your recent actions will appear here once you start using ClassroomHub!</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}